<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FuWiki</title>

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/common.css">

    <script src="js/marked.js"></script>

    <script src="js/jquery-1.10.2.js"></script>
    <script src="js/jquery-migrate-1.2.1.js"></script>

    <!-- date formatting -->
    <script src="js/moment.js"></script>

    <script src="js/config.js"></script>
    <script src="js/sparql-templates.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/core.js"></script>

    <script type="text/javascript" language="javascript">
        $(function () {
            spinner();

            var pageURI = queryString["uri"];
            pageURI = encodeURI(pageURI);

            var map = {
                "pageURI": pageURI,
                "graphURI": graphURI
            };

            var getPageSparql = templater(getPageSparqlTemplate, map);

            var getPageUrl = sparqlQueryEndpoint + encodeURIComponent(getPageSparql) + "&output=xml";

            var doneCallback = function (xml) {
                entry = xmlToEntry(xml, pageURI);
            //    $("#entry").replaceWith(entry);
            //    translateLocalLinks();
            //    fixHeaderIDs(); // little workaround for odd marked.js behaviour
            };

            getPage(doneCallback, getPageUrl);

            $('#editButton').click(function () {
                window.location.href = window.location.href.replace("page.html", "edit.html");
                return false;
            });
        });

        function formatEntry(uri, date, title, content, nick) {
            content = marked(content);
            date = moment(date).format("dddd, MMMM Do YYYY, h:mm:ss a");

            var map = {
                "uri": uri,
                "title": title,
                "date": date,
                "content": content,
                "nick": nick
            };

            var entryTemplate = "<div class='entry'> \
            <h1 class='center'><a href=${uri}>${title}</a></h1> \
            <div class='content'>${content}</div> \
            <div class='byline center'>latest edit by ${nick} on ${date}</div> \
            </div>";
            return templater(entryTemplate, map);
        }
    </script>
    <script id="injection" type="text/javascript" language="javascript">
</script>

</head>

<body>
    <div id="container">

        <div colspan="8" class="center"><a href="index.html">FuWiki</a>
        </div>

        <div id="entry"></div>

        <p class="center">
            <button id="editButton">Edit</button>
        </p>

        <div id="spinner" class="spinner"></div>
    </div>
</body>

</html>
