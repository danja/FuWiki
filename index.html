<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FooWiki</title>

    <link rel="stylesheet" href="css/columns.css" />
    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/common.css" />
    <link href="css/jquery.tagit.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/tagit.ui-zendesk.css">
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css" />

    <script src="js/jquery-1.10.2.js"></script>
    <script src="js/jquery-ui.min.js" type="text/javascript" charset="utf-8"></script>

    <!-- from https://github.com/aehlke/tag-it -->
    <script src="js/tag-it.js" type="text/javascript" charset="utf-8"></script>

    <!-- markdown processor -->
    <script src="js/marked.js"></script>

    <!-- mustache template compiler -->
    <script src="js/hogan-3.0.2.js"></script>

    <!-- script src="js/jquery-ui.js"></script>
    <script src="js/jquery.fileupload.js"></script>
    <script src="js/jquery.iframe-transport.js"></script -->

    <!-- date formatting -->
    <script src="js/moment.js"></script>

    <!-- FooWiki scripts -->
    <script src="js/config.js"></script>
    <script src="js/sparql-templates.js"></script>
    <script src="js/html-templates.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/core.js"></script>



    <script type="text/javascript" language="javascript">
        //  var getPageListSparql = replaceAll(getPageListSparqlTemplate, "${graphURI}", graphURI);
        var getPageListSparql = templater(getPageListSparqlTemplate, {
            "graphURI": graphURI
        });
        var getPagesUrl = sparqlQueryEndpoint + encodeURIComponent(getPageListSparql) + "&output=xml";

        $(function () {
            setupErrorHandling();
            spinner();

            $("#graphName").attr("value", graphURI);
            setupButtons();

            var doneCallback = function (xml) {
                var rows = makeEntryListHTML(xml, false);
                $("#entries").replaceWith(rows);
                setupTagsPanel("#tagsPanelTagsContainer");
            };
            getDataForURL(doneCallback, getPagesUrl);
        });



        function setupButtons() {
            $("#turtle").click(function () {
                var turtleURL = sparqlQueryEndpoint + "CONSTRUCT+%7B+%3Fs+%3Fp+%3Fo+%7D++WHERE+%7B%0D%0A+++GRAPH+%3Chttp%3A%2F%2Fhyperdata.it%2Fwiki%3E+%7B%0D%0A++++++%3Fs+%3Fp+%3Fo%0D%0A+++%7D%0D%0A%7D&output=text";
                location.href = turtleURL;
            });

            $("#newPageButton").click(function () {
                var newPageName = $("#newPageName").val();

                window.location.href = window.location.href = serverRootPath + "edit.html?uri=" + graphURI + "/" + newPageName;
            });

            // OLD
            $("#upload-button").click(function () {
                var data = new FormData($("#upload-file").val());
                console.log("DATA = " + data);
                $.ajax({
                    url: sparqlUpdateEndpoint,
                    type: 'POST',
                    data: ({
                        update: data
                    }),
                    //    contentType: "application/sparql-update",
                    processData: false,
                    contentType: false
                });
                //    e.preventDefault();
            });
            // NEW
            /*
            $('#fileupload').fileupload({
                dataType: 'json',
                done: function (e, data) {
                    $.each(data.result.files, function (index, file) {
                        $('<p/>').text(file.name).appendTo(document.body);
                    });
                }
            });
            */
        }
    </script>
</head>

<body>
    <div id="container">
        <div id="errorbox"></div>
        <table id="pagesTable"><!-- refactor to use entryTableTemplate -->
            <tr>
                <th colspan="3"><a href="index.html">FuWiki</a> Pages</th>
            </tr>
            <tr>
                <th class="center">Page</th>
                <th class="center">Date</th>
                <th class="center">Creator</th>
            </tr>
            <tr id="entries"></tr>
        </table>

        <p>
            <label for='newPageName'>New Page</label>
            <button id="newPageButton">Create New Page</button>
            <input id="newPageName" type="text" size="40" />
        </p>
        <p>

            <!-- form id="upload-form" enctype="multipart/form-data">
                <input type="file" id="upload-file" name="upload" />
                <button type="submit" id="upload-button">Upload Turtle</button>
            </form -->
            <h3>Upload RDF</h3>
            <form action="/foowiki/upload" enctype="multipart/form-data" method="post">
                <!-- TODO move to config (bypass Fuseki) -->
                <!-- onsubmit="window.location.href = 'index.html'; return false;" -->
                <input id="filename" type="file" name="UNSET FILE NAME" size="40" multiple="">
                <label for='graphName'>Graph</label>
                <input name="graph" id="graphName" size="20" value="default" />
                <br/>
                <input type="submit" value="Upload">
            </form>
            <h3>Export Turtle</h3>
            <button id="turtle">Export</button>
        </p>
        <div id="tagsPanel">
            <label for='tagsPanelTagsContainer'>Tags</label>
            <ul id='tagsPanelTagsContainer'>
            </ul>
        </div>

        <!-- input id="fileupload" type="file" name="files[]" data-url="/foowiki/upload" multiple -->

        <div id="spinner" class="spinner"></div>
    </div>
</body>

</html>
